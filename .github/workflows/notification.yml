name: Actions Notification Test
on: [pull_request, push]

jobs:
  actions-notification-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Setup environment
        run: echo "INPUT_WEBHOOK=${{ secrets.WEBHOOK_URL }}" >> $GITHUB_ENV

      - name: Run action
        if: Always()
        run: go run cmd/main.go
        env:
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
          GITHUB_STATUS: ${{ job.status }}
          GITHUB_COMMIT_MESSAGE: ${{ github.event.commits[0].message }}
          GITHUB_PR_TITLE: ${{ github.event.pull_request.title }}
          GITHUB_PR_URL: ${{ github.event.pull_request.html_url }}

      - name: Run action
        if: Always()
        run: go run cmd/main.go
        env:
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
          GITHUB_STATUS: "failure"
          GITHUB_COMMIT_MESSAGE: ${{ github.event.commits[0].message }}
          GITHUB_PR_TITLE: ${{ github.event.pull_request.title }}
          GITHUB_PR_URL: ${{ github.event.pull_request.html_url }}

      - name: Run action
        if: Always()
        run: go run cmd/main.go
        env:
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
          GITHUB_STATUS: "cancelled"
          GITHUB_COMMIT_MESSAGE: ${{ github.event.commits[0].message }}
          GITHUB_PR_TITLE: ${{ github.event.pull_request.title }}
          GITHUB_PR_URL: ${{ github.event.pull_request.html_url }}
